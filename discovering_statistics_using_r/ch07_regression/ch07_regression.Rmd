---
title: "chap 7. 회귀"
author: "dayoung"
date: '2020 10 17 '
output:
     html_document:
       toc: true
      toc_float: true

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# 7.1 이번 장에서 배우는 내용
- 미래는 누구도알지 못하지만, 그래도 미래를 에측히는 것은 아주 중요하기 때문에 생명체의 유전자에는 자신의 환경에서 벌어지는 예측 가능한 사건들에 관해 배우려는 본능이 박혀 있다.



# 7.2  회귀의 소개
- 하나의 모형을 자료에 적합시키고 그것을 이용해서 하나 이상의 독립변수(IV)들로부터  종속변수(DV)의 값들을 에측하는 것이 회귀분석이다.

단순회귀: 한 예측변수로부터 한 결과변수를 예측하는것을 부른다.
다충회귀: 여러개의 예측변수들로부터 한 결과변수를 에측하는것을 부른다.


## 7.2.1 직선에 관한 중요한 정보 몇가지

- 하나는 선의 기울기(slope: 경사도)이고, 다른 하는선이 그래프의 수직숙과
만나는 점이다. 

![](image/7.2 png)


## 7.2.2 최소제곱법
- x 변수의 값으로 y 값을 예측하고, 그것과 해당 자료점의 차이를 구하면 되는
것이다. 그런데 회귀분석에서는 그 차이를 이탈도나 편차라고 부르지 않고 
잔차(residual)라고 부르는 경우가 많다.

![](image/7.3 png)


## 7.2.3 적합도 



## 7.2.4 개별 예측변수의 평가

- 예측변수가 변해도 결과의 예측값은 변하지 않는다는 뜻이고, 해당 회귀선의 기울기가 0이라는, 다시 말해 회귀선이 수 평선이라는 뜻이다. 



## 이번 장에서 사용하는 패키지

install.packages("car")
install.packages("QuantPsyc")

```{r}
library(boot)
library(car)
library(QuantPsyc)
```

# R을 이용한 회귀분석 절차
## R commander를 이용한 단순회귀분석

-R commander 에서 회귀분석을 실행하기위해, 우선 다음 명령으로 R commander를 띄운다.

install.packages("Rcmdr")
```{r}
library(Rcmdr)
```





## 7.4.2 R을 이용한 회귀분석

```{r}
album1 <- read.delim(“Album Sales 1.dat”, header = TRUE)

glimpse(album1)
```

- 새모형은 함수가 셍성한, 모형에 관한 정보를 담은 객체이다. 이후 summary(새모형)이나 summary.lm 형태의 명령을 실행하면 모형의 구체적인 매개변수들을 확인할수 있다.

- 결과변수는 예측하고자 하는 변수이다. 종속변수라고한다. 지금은 예예에서 결과변수는 sales 이다.

- 예측변수(들)에는 결과변수를 예측하는 데 사용할 하나의 변수 또는 변수들의 목록을 지정한다. 지금 예에서는 adverts를 지정하면 된다. 나중에 보겠지만, 좀더 복잡한 설계에서는 여러 개의 예측변수를 지정한다.


# 7.5 단순회귀의 해석

- 이제 회귀분석의 결과를 담은 albumSales.1 이라는 객체가 생겼다. 다음 명령을 실행하면 이 객체의 내용이 출력된다.

```
summary(albumSales.1)
```

## 7.5.1 모형의 전반적인 적함도

- 우선 출력 7.1의 마지막 부분애 있는 다음에 행에 주목하자.
mutiple R-squared: 0.3346, Adjusted R-squared: 0.3313


```{r}
sqrt(0.3346)
```

## 7.5.2 모형 매개변수들

- 예측변수의 단위 변화에 따른 결과의 변화를 나타내는 값이라고 생각하는 것이 더 유용하다.


## 7.5.3 모형의 활용

- 모형으로 결과를 예측할 때는 식 (7.2)를 사용한다. 앞애서 구한 b 값들을 식 (7.2)에 대입하면 우리의 음반 판패량 예측 모형을 정의하는 다음과 같은 공식이 나온다.

음반 판매량= b0+b1* 광고비  =134.14 + (0.096 × 광고비)


# 7.6 다중회귀: 기조

- 매개변수들을 구할 때는 하나의 통계적 모형(단수회귀에서는 직선을) 자료에 적합시켜보고, 실제 자료점과의 차이 제곱합이 가장 작은 선을 선택한다. 이런한 방법을 최소제곱이라고 부른다.

결과= (모형) + 오차

## 7.6.1 다중회귀모형의 예

- 회사 중역이 음반 판매량 예측 모형에  또 다른 변수를 추가하지로 했다고 하자. 

- 이전의 회귀분석에는 우리 광고비가 음반 판매량 변도의 33%를 설명하지 만, 그보다 더 큰 67%는 설명하기 위해 새로운 변수를 추가하기로 했다.

![](image/7.8 png)


## 7.6.4 여러 회귀 방법

- 회계수들은 모형의 변수들에 의존하므로, 묘형의 예측변수들은 세심하게 선택할 필요가 있다. 회귀게수가 다르면 모형의 예측력도 달지므로, 어떤 변수를 모형에 추가하느냐는 회귀분석의 결과에 큰 영향을 미친다.

## 7.6.4.1 위계적 방법

- 위계적 회귀에서는 과거 연구에 기초해서 예측변수들은 선택하되, 그 예측진 변수들은 모형에 도입하는 순서를 실험자가 결정한다.


## 7.6.4.2 강제 도입법

- 강제 도입법 은 모든 예측변수를 모형에 동시에 도입하는 것이다. 위계적 방법에서처럼 이 방법은 선택된 예측변수들은 도입할 튼튼한 이론적 이유가 존재할 때바람직하다.



## 7.7.2.2 회귀모형의 평가 II: 일반화

- 회귀분석을 실행하며 표본의 관측값들은 정확히 예측하는 회귀 벙정식이 나온다.
그러나 사회과학에서는 그러한 모형을 일반화함으로써 표본 이상의 것에 관한 뭔가를 알아내려고 하는 경우가 많다.


## 7.7.2.4 공선성

- 다중공선성은 회귀모형에 있는 둘 이상의 예측변수들은 사이에 강한 상관관계가 순회귀에는 예측변수가 하나뿐이기 때문이다. 

- 와전공선성이 존재한다고 말한다(가장 간 단한 예는 두 예측변수의 관계가 완전 상관,즉 상관계수가 1인 경우이다.)

![](image/7.10 png)

- b들을 믿을 수 없게 된다: 공신성이 높아지면 b 게수들의 표준오차도 커진다. 표준오차의 의미를 생각해보면, b 계수의 표준오차가 커진다는 것은 표본애 따른 b의 변동이 커진다는 뜻임을 알 수 있을 것이다.



# 7.8 다중회귀: 기본모형 실행
## 7.8.2.1 R Commander를 이용한 다중회귀: 기본 모형

-  음역이 음반 판매량 모험을 좀 더 확장하기로 헸다고 상상해보자. 중역은 새로운 변수 두 개를 정하기로 했다. 하나는 음반 출시 전 한 주 동안 음반의 노래들이 라디오 1에방송된 횟수이고, 다른 하나는 밴드의 매력이다 

```{r}
library(Rcmdr)
```

# 7.8.3 기본 다중회귀의해석
## 7.8.3.1 모형 요약

- 이 모형들의(요약)은 summary()함수로 볼 수 있다. 

```{r}
summary(albumSales.2)
summary(albumSales.3)
```


## 7.8.4.1 R Commander를 이횽한 모형 비교

- R Commander에서 뒤 위계적 모형을 비교하려먼 주 메뉴에서 모델-가설 검정- 두 모텔  비교하기를 선택한다. 


# 7.9 회귀모형의 정확도 검정
## 7.9.1 R Commander를 이용한 진단 검정

- R commander로 다양한 종류의 진단 검정을 실행할 수 있고, 모형을 여러 가지로 수정할 수 도 있다.  

![](imgage/7.14 R commander를 이용한 회귀 진단 png)


## 7.9.3 독립성 가정의 평가

- R 에서는 그냥 계산할 때는 durbinWastonTest() 함수(첫 글자가 소문자 d 이고, 중간의 W와 T는 대문자임을 주의해야 한다) 나 dwt() 함수를 이욯하면 된다.

```{r}
durbinWatsonTest(albumSales.3)
```

## 7.9.4 다중공선성 부재 가정의 평가

- 공선성 평가하는데 유용한 통계랑은 vIF(뷴산 팽창인자)와 그것의 역수인 허용 통계량이다.
VIF는 vif() 함수로 얻을 수 있다. 

```{r}
vif(albumSales.3)
```

## 7.9.5 잔차에 관한 여러 가정의 점검

- 그래프를 살펴보면 오차의 무작위성과 등분 산성을 눈으로 확인할 수 있기 때문이다.출판을 위한 고품질 그래프를 만들고 싶다면 ggplot2 패키지를 사용하는 것이 좋다. 지금 처럼 그냥 가정들을 확인하는 목적이라면 더 간단한(그러나 덜 예쁜) 내장 함수 plot()과 hist()로 충분한다.


*출판 품질 그래프*

- 이 예측값을 담은 fitted 라는 변수가 원래의 데이터프레임을 새로 생겼다. 그리고 앞에서 데이터프레임에 스튜던트화 잔차들은 담은 studentized.residuals라는 변수를 추가했음 을 기억할 것이다.

```{r}
histogram<-ggplot(album2, aes(studentized.residuals)) + opts(legend.position =
"none") + geom_histogram(aes(y = ..density..), colour = "black", fill = "white") +
labs(x = "Studentized Residual", y = "Density")
histogram + stat_function(fun = dnorm, args = list(mean = mean(album2$studentized.
residuals, na.rm = TRUE), sd = sd(album2$studentized.residuals, na.rm = TRUE)), colour
= "red", size = 1)
```

-Q-Q그림을 만들려면 다음 명령을 실행하면된다.

```{r}
qqplot.resid <- qplot(sample = album2$studentized.residuals, stat="qq") + labs(x =
"Theoretical Values", y = "Observed Values")


```

- 마지막으로 , 다음 명령들을 실행하면 스튜던트화 잔차 대 예측값의 산점도가 만들어진다.

```{r}
scatter <- ggplot(album2, aes(fitted, studentized.residuals))
scatter + geom_point() + geom_smooth(method = "lm", colour = "Blue")+ labs(x = "Fitted
Values", y = "Studentized Residual")
```


# 7.11 다중회귀의 보고

- 미국 심리학회(APA)의 지침에 따라 다중상관을 보고 한다면, 분석결과를 표로 만드는것이 바람직하다.APA는 또한 적어도 표준화된 베타들과 그 유익확률들, 그리고  모형에 관한 몇 가지 일반적인 통계량들을 보고 하는것을 선호하는 것으로 보인다.


# 7.12 범주형 예측변수와 다중회귀

-회귀분석릉 예측변수가 연속변수이거나 범주가 두 개뿐인 범주형이라는 가정을 깔고 있음을 기억해야 한다. 
- $6.57에서 보았듯이 한 변수가 연속변수이고 다른 한 변수가 0과 1로 부호화된 두 범주를 가진 범주형변수일 때 그 두 변수의 피어슨 상관계수 r은 곧 점이연 상관계수이다.



## 7.12.2 가변수를 이용한 회귀분석

- 가변수들은 다음에는 다른 종류의 회귀분석에서와 같은 방식으로 회귀분석을 실행하면된다. 해당 명령은 다음과 같다.

```{r}
glastonburyModel<-lm(change ~ music, data = gfr)
summary(glastonburyModel)
```






